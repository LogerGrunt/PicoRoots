pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--main cycle functions

function _init()
--	set_sky_vars()
end

function _update()
	update_stats()
	move_selection()
	check_build()	
end


function _draw()
	cls()
	cam_mov()
	map()
	--draw_level()
	draw_selected()
	print_stats()
	print("selected:" .. tile_type(selectionx,selectiony),3)
end


-->8
--draw functions


--function draw_level()
--	foreach(sky_tiles,draw_sky)
--end

--function draw_sky(s)
--	spr(3,s[1]*8,s[2]*8)
--end


function draw_selected()
	spr(5,selectionx*8,selectiony*8)
end

function cam_mov()
	camx=mid(0,selectionx-8,112)*8
	camy=mid(0,selectiony-8,48)*8
	camera(camx,camy)
end
-->8
--selection code

selectionx=0
selectiony=0

function move_selection()
	if (btnp(⬆️)) selectiony-=1
	if (btnp(⬇️)) selectiony+=1
	if (btnp(➡️)) selectionx+=1
	if (btnp(⬅️)) selectionx-=1
	selectionx=mid(0,selectionx,15)
	selectiony=mid(0,selectiony,15)
end



-->8
--stats code

water_level=100
vitamin_level=100

function update_stats()
	water_level=mid(0,water_level,100)
	vitamin_level=mid(0,vitamin_level,100)
end

function print_stats()
	print("water level:" .. water_level .. "%",camx,camy)
	print("vitamins:" .. vitamin_level .. "%",camx,camy+8)
end


-->8
--misc tile code is here

sky_tiles={3}
earth_tiles={1}
water_tiles={4}
fertile_tiles={17}
rock_tiles={6}
grass_tiles={2}
root_tiles={7,8}

function tile_type(x,y)
	tile=mget(x,y)
	for i=1,#sky_tiles do 
		if (sky_tiles[i]==tile) return "sky"
	end
	for i=1,#earth_tiles do 
		if (earth_tiles[i]==tile) return "earth"
	end
	for i=1,#water_tiles do 
		if (water_tiles[i]==tile) return "water"
	end
	for i=1,#fertile_tiles do 
		if (fertile_tiles[i]==tile) return "vitamin"
	end
	for i=1,#rock_tiles do 
		if (rock_tiles[i]==tile) return "rock"
	end
	for i=1,#root_tiles do 
		if (root_tiles[i]==tile) return "root"
	end
	for i=1,#grass_tiles do 
		if (grass_tiles[i]==tile) return "grass"
	end
end	

-->8
--root code

function check_adjacent(x,y)
	if tile_type(x+1,y)=="root" or tile_type(x-1,y)=="root" or tile_type(x,y+1)=="root" or tile_type(x,y-1)=="root" then
		return true
	end
end

function build_root(x,y)
	if check_adjacent(x,y)==true then
		if tile_type(x,y)=="water" then
			mset(x,y,8)
			vitamin_level+=10
			water_level+=15

		end
		if tile_type(x,y)=="vitamin" then
			mset(x,y,7)
			vitamin_level+=15
		end
		if tile_type(x,y)=="earth" then
			mset(x,y,7)
			water_level-=10
			vitamin_level-=5
		end
	end	
end

function check_build()
	if btnp(4) then
	 build_root(selectionx,selectiony)
	end
end
__gfx__
000000005555555537333333cccccccc111111117777777744444444554444551144441100000000000000000000000000000000000000000000000000000000
00000000555555557a733733cccccccc111111117000000744444444555445551114411100000000000000000000000000000000000000000000000000000000
007007005555555537337a73cccccccc111111117000000744455544455445544114411400000000000000000000000000000000000000000000000000000000
00077000555555553b333733cccccccc111111117000000744556754444444444444444400000000000000000000000000000000000000000000000000000000
00077000555555553b333b33cccccccc111111117000000745556654444444444444444400000000000000000000000000000000000000000000000000000000
007007005555555533333b33cccccccc111111117000000745555554455445544114411400000000000000000000000000000000000000000000000000000000
000000005555555533333333cccccccc111111117000000744555544555445551114411100000000000000000000000000000000000000000000000000000000
000000005555555533333333cccccccc111111117777777744444444554444551144441100000000000000000000000000000000000000000000000000000000
00000000555bcc550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000054444c550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000514beee50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000051cbecaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000051cd8afa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000077cc8ff50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007dddfff50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000558888550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010107070101011101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104040401010107070101111101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101040401010107070101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101011101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101040404010101111101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
